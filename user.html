<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>About User</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root {
      --blue-100: #e9f4ff;
      --blue-200: #d7ecff;
      --blue-500: #2b7ed6;
      --blue-600: #1f6bb2;
      --text-col: #243547;
      --card-bg: #ffffff;
    }

    :root[data-bs-theme="dark"] {
      --blue-100: #0d1b2a;
      --blue-200: #1b263b;
      --blue-500: #415a77;
      --blue-600: #778da9;
      --text-col: #e6ebf0;
      --card-bg: #1b263b;
    }

    body {
      font-family: Inter, sans-serif;
      padding-top: 90px;
      padding-bottom: 70px;
      background: linear-gradient(180deg, var(--blue-100), var(--blue-200));
      color: var(--text-col);
    }

    .navbar {
      background: linear-gradient(90deg, var(--blue-500), var(--blue-600));
    }

    .navbar-brand,
    .nav-link { color:white !important; }

    .card-clean {
      background: var(--card-bg);
      border-radius: 14px;
      padding: 25px;
      box-shadow: 0px 8px 20px rgba(0,0,0,0.08);
    }

    footer {
      background: linear-gradient(90deg, var(--blue-500), var(--blue-600));
      color: white;
      padding: 12px 0;
      position: fixed;
      bottom: 0;
      width: 100%;
      text-align: center;
    }
  </style>
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark fixed-top">
  <div class="container-fluid">

    <a class="navbar-brand fw-bold"><i class="bi bi-person"></i>User</a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#menu">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="menu">
      <ul class="navbar-nav ms-auto">

        <!-- DARK MODE TOGGLE (added) -->
        <li class="nav-item me-2 d-flex align-items-center">
          <button id="darkModeToggle" class="btn btn-outline-light btn-sm">
            <i id="darkModeIcon" class="bi bi-moon-stars-fill"></i>
          </button>
        </li>

        <li class="nav-item"><a class="nav-link" href="destination.html"><i class="bi bi-geo-alt-fill"></i> Destination</a></li>
        <li class="nav-item"><a class="nav-link" href="user.html"><i class="bi bi-person"></i>User</a></li>
        <li class="nav-item"><a class="nav-link" href="dashboard.html"><i class="bi bi-speedometer2"></i> Dashboard</a></li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
            <i class="bi bi-person-circle"></i> Profile
          </a>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item text-danger" href="login.html"><i class="bi bi-box-arrow-right"></i> Sign Out</a></li>
          </ul>
        </li>

      </ul>
    </div>
  </div>
</nav>

<!-- MAIN CONTENT -->
<div class="container">

  <!-- USER HEADER -->
  <div class="card-clean mb-4 text-center">
    <img src="profile.jpeg" class="rounded-circle mb-3" width="120">
    <h3 id="userName">Nur Aida Hadfina Binti Mohamad Saroja</h3>
    <p id="userJob" class="text-secondary">Business Analyst</p>
  </div>

  <!-- TRAVEL SUMMARY -->
  <div class="card-clean mb-4">
    <h4 class="fw-bold mb-3">Travel Summary</h4>

    <p><strong>Total Countries Visited:</strong> <span id="totalCountries">0</span></p>
    <p><strong>Most Visited Country:</strong> <span id="mostVisited">-</span></p>
    <p><strong>Least Visited Country:</strong> <span id="leastVisited">-</span></p>

    <hr>

    <h5 class="fw-bold">Monthly Visits</h5>
    <ul id="monthlyList"></ul>
  </div>

  <!-- SPENDING SUMMARY -->
  <div class="card-clean mb-5">
    <h4 class="fw-bold mb-3">Financial Summary (Yearly)</h4>

    <p><strong>Estimated Spending (Total Budget):</strong> RM <span id="estSpend">0</span></p>
    <p><strong>Actual Spending:</strong> RM <span id="actualSpend">0</span></p>

    <p class="mt-3 fs-5 fw-bold">
      Balance: RM <span id="balance">0</span>
    </p>
  </div>

</div>

<footer>© 2025 Travel Planner • All Rights Reserved</footer>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* ---------------- DARK MODE (synced across pages) ---------------- */
const toggleBtn = document.getElementById("darkModeToggle");
const icon = document.getElementById("darkModeIcon");
const htmlTag = document.documentElement;

const savedTheme = localStorage.getItem("theme") || "light";
htmlTag.setAttribute("data-bs-theme", savedTheme);
if (savedTheme === "dark") {
  icon.classList.replace("bi-moon-stars-fill", "bi-brightness-high-fill");
}

toggleBtn.addEventListener("click", () => {
  const current = htmlTag.getAttribute("data-bs-theme");
  const next = current === "light" ? "dark" : "light";

  htmlTag.setAttribute("data-bs-theme", next);
  localStorage.setItem("theme", next);

  if (next === "dark") {
    icon.classList.replace("bi-moon-stars-fill", "bi-brightness-high-fill");
  } else {
    icon.classList.replace("bi-brightness-high-fill", "bi-moon-stars-fill");
  }
});

/* ---------------- LOAD DESTINATION DATA ---------------- */
const destinations = JSON.parse(localStorage.getItem("destinations") || "[]");

let monthly = {};
let countryCount = {};

destinations.forEach(d=>{
  if(!d.start) return;

  let month = new Date(d.start).toLocaleString("default",{month:"long"});
  if(!monthly[month]) monthly[month] = [];

  monthly[month].push(d.country);

  countryCount[d.country] = (countryCount[d.country] || 0) + 1;
});

/* RENDER MONTHLY LIST */
const ul = document.getElementById("monthlyList");
for(let m in monthly){
  let li = document.createElement("li");
  li.innerHTML = `<strong>${m}:</strong> ${monthly[m].join(", ")}`;
  ul.appendChild(li);
}

/* CALCULATE MOST + LEAST */
let countries = Object.keys(countryCount);

// totalCountries = number of unique countries visited
document.getElementById("totalCountries").innerText = countries.length || 0;

if(countries.length){
  let sorted = countries.sort((a,b)=> countryCount[b] - countryCount[a]);

  document.getElementById("mostVisited").innerText = sorted[0];
  document.getElementById("leastVisited").innerText = sorted[sorted.length - 1];
}

/* ---------------- SPENDING ---------------- */
let totalEstimated = 0;
let totalActual = 0;

// Estimated Spending = TOTAL BUDGET for all trips in the year
destinations.forEach(d=>{
  totalEstimated += Number(d.budget || 0);
});

// Actual Spending = sum of all activities across trips
for(let key in localStorage){
  if(key.startsWith("trip_activities_")){
    let acts = JSON.parse(localStorage.getItem(key) || "[]");
    acts.forEach(a=>{
      totalActual += Number(a.cost || 0);
    });
  }
}

document.getElementById("estSpend").innerText = totalEstimated;
document.getElementById("actualSpend").innerText = totalActual;

document.getElementById("balance").innerText =
  (totalEstimated - totalActual).toFixed(2);

/* ---------------- DASHBOARD SYNC CODE ---------------- */
/* Monthly trip statistics for Chart.js */
let monthNames = [
  "January","February","March","April","May","June",
  "July","August","September","October","November","December"
];

let monthlyTripsArray = monthNames.map(m => monthly[m] ? monthly[m].length : 0);

/* Save to localStorage → Dashboard will read this */
localStorage.setItem("monthlyTrips", JSON.stringify(monthlyTripsArray));

/* Save spending info for dashboard */
localStorage.setItem("user_estimated_spending", totalEstimated);
localStorage.setItem("user_actual_spending", totalActual);
localStorage.setItem("user_balance", (totalEstimated - totalActual).toFixed(2));

</script>

</body>
</html>
